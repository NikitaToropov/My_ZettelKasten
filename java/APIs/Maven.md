# Maven — инструмент для управления и сборки проектов.

* Понятная модель которую можно переиспользовать + подключаемые плагины
    * TODO не понятно что подразумевается под "Моделью"
* Структура определяется в [[POM]].xml - (Project Object Model)  базовый модуль

---

# Аспекты которыми можно управлять с Maven:

* Создание
* Документирование
* Отчёты
* Зависимости
* Релизы
* SCM
* Список рассылки
* Дистрибьюция

---

## Соглашение о конфигурации:

* Maven использует базовую структуру проекта.
* Разработчик не обязан указывать каждую деталь. В таком случае Maven использует дефолтную структуру проекта.
* Разработчик несет ответственность за соответственное размещение файлов.

### Значения по умолчанию для исходного кода проекта и других модулей:

Можно получить плагином archtype используя архетип quickstart:

```
mvn archetype:generate -DarchetypeGroupId=org.apache.maven.archetypes -DarchetypeArtifactId=maven-archetype-quickstart -DarchetypeVersion=1.4
```

| Модуль | Расположение относительно корня |
|----------|--------|
| Исходный код | src/main/java |
| Ресурсы | src/main/resources |
| Тесты | src/test |
| JAR дистрибутив | /target |
| Скомпилированный байт-код | /target/classes |

---

## Жизненный цикл сборки в Maven:

Maven имеет 3 стандартных жизненных цикла.

* ```clean``` - для очистки проекта от прошлых сборок.
* ```default``` - для сборки и развертывания проекта.
* ```site``` - для публикации в вебе.

Каждый из циклов определяется своей последовательностью разных фаз сборки. Фаза сборки - этап жизненного цикла.

### Сlean

| Фаза | Описание |
|----------|--------|
| ```pre-clean``` | выполнить процесс до фактической чистки проекта |
| ```clean``` | удалить все файлы, созданные предыдущей сборкой |
| ```post-clean``` | выполняет процессы для завершения удаления |

### Default

| Фаза | Описание |
|----------|--------|
| ```validate``` | проверка что проект валидный и все необходимы данные имеются |
| ```initialize``` | инициализация состояния для сборки, например установить проперти или создать структуру каталогов |
| ```generate-sources``` | генерация кода для включения в компиляцию |
| ```process-sources``` | обработка исходного кода, например фильтрация неиспользуемых значений |
| ```generate-resources``` | генерация ресурсов для включения в пакет |
| ```process-resourcres``` | обработка и копирование ресурсов в целевую директорию, подготовка к упаковке |
| ```compile``` | компиляция исходного кода проекта |
| ```process-classes``` | постобработка скомпилированных файлов, например оптимизация байткода |
| ```generate-test-sources``` | генерация исходного кода тестов, для включения в компиляцию |
| ```process-test-sources``` | обработка исходного кода тестов, например фильтрация неиспользуемых значений |
| ```generate-test-resources``` | генерация ресурсов для тестов |
| ```process-test-resources``` | обработка и копирование ресурсов в целевую директорию для тестов |
| ```test-compile``` | компиляция исходного кода тестов и в целевую директорию с тестами |
| ```process-test-classes``` | постобработка скомпилированных файлов, например оптимизация байткода |
| ```test``` | исполнение юниттестов с подходящим фреймворком, эти тесты не требуют упаковки и развертывания |
| ```prepare-package``` | любые операции для подготовки к упаковке |
| ```package``` | упаковка скомпилированного кода в архи, JAR/WAR |
| ```pre-integration-test``` | выполнение действий необходимых до выполнения интеграционных тестов, например поднять окружение |
| ```integration-test``` | обработка, развертывание (если необходимо) в исполняемой среде и запуск интеграционных тестов |
| ```post-integration-test``` | выполнение действий необходимых после выполнения интеграционных тестов, например очистка окружения |
| ```verify``` | любые проверки на то что упакованный проект валидный и соответвствует критериям |
| ```install``` | установка упакованного проекта в локальный репозитория для использования его как зависимости в других проектах локально |
| ```deploy``` | копирование и перенос готового упакованного проекта в удаленный репозиторий, чтобы им можно было пользоваться не только локально |

### Site

| Фаза | Описание |
|----------|--------|
| ```pre-site``` | выполняет процессы необходимые до фактического создания сайта проекта |
| ```site``` | генерирует документацию для сайта проекта |
| ```post-site``` | выполняет процессы финализирующие создание сайта проекта и необходимые для его развертывания |
| ```site-deployment``` | развертывание сгенерированной документации сайта на указанном веб-сервере |

[Источник](https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#default-lifecycle)

---

Goal(задача) - специальная задача, которая относиться к сборке проекта и его управлению.

* мб привязана к одной или нескольким фазам сборки
* если не привязана ни к одной фазе, то мб запущена вне фазавой сборки, прямым вызовом
    * TODO надо пример, пока не понятно.
* порядок выполнения целей зависит от порядка вызова целей и фаз.
    * Пример: ```mvn clean dependency:copy-dependencies package```
        * фаза **clean**
        * цель **dependency:copy-dependencies**
        * фаза **package**

---

### [Maven Archetypes](https://maven.apache.org/archetypes/index.html)

```
mvn archetype:generate -DarchetypeGroupId=org.apache.maven.archetypes -DarchetypeArtifactId=maven-archetype-quickstart -DarchetypeVersion=1.4
```

Инициализирует структуру и делает минимальныую ностройку [POM](POM.md).


---

### Аргументы для запуска Java приложения

#### JVM Options

* Пользовательские опции ```-Dkey=value```
    * Содержатся среди ```Syste.getProperties()```
* Зарезервированные ```-Xkeyvalue```
    * Содержатся среди ```Syste.getProperties()```
* Зарезервированные более низкоуровневые ```-XX``` 


